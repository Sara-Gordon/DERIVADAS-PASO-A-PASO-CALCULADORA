<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Derivadas por Primer Principio</title>
  <script src="https://unpkg.com/algebrite"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #fff0f5;
      padding: 20px;
      color: #333;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 5px;
      border-radius: 10px;
    }
    #result {
      background: #ffe6f0;
      padding: 15px;
      border-radius: 15px;
      margin-top: 15px;
      border: 1px solid #ff80ab;
    }
    .step {
      margin-bottom: 10px;
    }
    .frac {
      display: inline-block;
      text-align: center;
    }
    .frac > span {
      display: block;
    }
    .frac .top {
      border-bottom: 1px solid #000;
    }
  </style>
</head>
<body>
  <h1>üìò Derivada por Primer Principio</h1>
  <p>Ingresa una funci√≥n (ej: <strong>2x</strong>, <strong>x^2</strong>, <strong>ln(x)</strong>, <strong>e^x</strong>, <strong>raiz(x)</strong>):</p>
  <input type="text" id="funcion" placeholder="Ej: x^2 + 3x" />
  <button onclick="resolver()">Resolver</button>
  <div id="result"></div>
  <div id="grafica" style="width:100%;height:400px;"></div>

  <script>
    function convertirFuncion(texto) {
      return texto
        .replace(/(\d)([a-zA-Z])/g, '$1*$2')       // 2x ‚Üí 2*x
        .replace(/([a-zA-Z])(\d)/g, '$1*$2')       // x2 ‚Üí x*2
        .replace(/raiz\(/g, 'sqrt(')               // raiz(x) ‚Üí sqrt(x)
        .replace(/e\^/g, 'exp(').replace(/\)(?!\^)/g, '))') // e^x ‚Üí exp(x)
        .replace(/ln\(/g, 'log(');                 // ln(x) ‚Üí log(x)
    }

    function resolver() {
      const entrada = document.getElementById("funcion").value;
      const fx = convertirFuncion(entrada);
      const resultDiv = document.getElementById("result");
      let pasos = "";

      try {
        const h = Algebrite.run("h");
        const x = Algebrite.run("x");
        const fx_h = Algebrite.run("subst(x, x+h, " + fx + ")");
        const resta = Algebrite.run("(" + fx_h + " - (" + fx + "))");
        const fraccion = Algebrite.run("(" + resta + ")/h");
        const derivada = Algebrite.run("limit(" + fraccion + ", h, 0)");

        pasos += `<div class="step"><strong>PASO 1:</strong> Se parte de la definici√≥n formal:<br>
        <span class="frac"><span class="top">f(x+h) - f(x)</span><span class="bottom">h</span></span></div>`;

        pasos += `<div class="step"><strong>PASO 2:</strong> Se reemplaza f(x):<br> f(x) = ${entrada}</div>`;
        pasos += `<div class="step"><strong>PASO 3:</strong> Se calcula f(x+h):<br> f(x+h) = ${Algebrite.run("simplify(" + fx_h + ")")}</div>`;
        pasos += `<div class="step"><strong>PASO 4:</strong> Se reemplazan en la f√≥rmula:<br>
        <span class="frac"><span class="top">(${fx_h}) - (${fx})</span><span class="bottom">h</span></span></div>`;
        pasos += `<div class="step"><strong>PASO 5:</strong> Se simplifica el numerador:<br> ${resta}</div>`;
        pasos += `<div class="step"><strong>PASO 6:</strong> Se divide entre h:<br> ${fraccion}</div>`;
        pasos += `<div class="step"><strong>PASO 7:</strong> Se aplica el l√≠mite cuando h ‚Üí 0:</div>`;
        pasos += `<div class="step"><strong>Resultado Final:</strong> La derivada es: <strong>${Algebrite.run("simplify(" + derivada + ")")}</strong></div>`;

        resultDiv.innerHTML = pasos;
        graficar(fx);
      } catch (error) {
        resultDiv.innerHTML = `<p style="color:red;">‚ö†Ô∏è No se pudo derivar la funci√≥n ingresada.<br>Revisa la sintaxis o funciones usadas.</p>`;
      }
    }

    function graficar(fx) {
      let expr = fx.replace(/\^/g, '**');

      const f = x => {
        try {
          return eval(expr.replace(/x/g, `(${x})`));
        } catch {
          return null;
        }
      };

      const x_vals = [];
      const y_vals = [];
      for (let x = -10; x <= 10; x += 0.5) {
        const y = f(x);
        if (y !== null && isFinite(y)) {
          x_vals.push(x);
          y_vals.push(y);
        }
      }

      const trace = {
        x: x_vals,
        y: y_vals,
        mode: 'lines',
        name: 'f(x)'
      };

      Plotly.newPlot('grafica', [trace], { title: 'Gr√°fica de la funci√≥n' });
    }
  </script>
</body>
</html>


